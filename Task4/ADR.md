### **Название задачи:** ADR-002 — MVP: “Передача актуальных ставок по депозитам в кол-центр и партнёрский кол-центр”
### **Автор:** Юрий З.
### **Дата:** 2025-12-26

---

### **Функциональные требования**

| **№** | **Действующие лица или системы** | **Use Case** | **Описание** |
| :-: | --- | --- | --- |
| 1 | Оператор кол-центра (внутренний), Система кол-центра, Rates & Products Service (RPS) | Консультация по текущим ставкам | 1) Оператор открывает карточку продукта/вопрос клиента.<br>2) Система кол-центра получает актуальные ставки из внутреннего источника (RPS/реестр ставок).<br>3) Оператор озвучивает условия клиенту.<br><br>Исключения: временная недоступность источника ставок → показываем “последнюю успешную версию” + отметку времени. |
| 2 | Система банка (RPS), Email/Файловый канал, Партнёрский кол-центр | Передача ставок партнёрскому кол-центру файлами | 1) Ежедневно (и при внеплановом изменении) банк формирует файл ставок.<br>2) Файл подписывается/контролируется целостность и отправляется партнёру **как файл** (без API-вызовов; SFTP нельзя).<br>3) Партнёр загружает файл в свою систему и использует для консультаций.<br><br>Исключения: не доставлено письмо/файл → ретрай + оповещение ответственного. |
| 3 | Бэк-офис депозитов/кредитов, RPS | Публикация новых ставок | 1) Уполномоченный сотрудник обновляет ставки (через регламентированную загрузку/интерфейс).<br>2) Система создаёт новую версию ставок и фиксирует аудит.<br>3) Внутренний кол-центр видит обновление сразу; партнёру уходит новая версия файлом. |
| 4 | Система аналитики | Контроль качества/актуальности | 1) Логируем версии ставок, время публикации, время доставки партнёру.<br>2) Отчёт: сколько минут/часов партнёр жил на старой версии. |

---

### **Нефункциональные требования**

| **№** | **Требование** |
| :-: | --- |
| N1 | Доступность получения ставок внутренним кол-центром 24/7, целевая 99,9% (консультации критичны при росте звонков). |
| N2 | Партнёрский кол-центр: обмен только файлами; **API-вызовы запрещены, включая SFTP**. |
| N3 | Актуальность: задержка доставки файлов партнёру ≤ 30 минут после публикации новой версии (целевой KPI). |
| N4 | Целостность: файл должен быть защищён от подмены (подпись/хэш) и иметь версионирование. |
| N5 | Безопасность: минимизация раскрытия — партнёру передаём только “публичные” ставки/условия без персональных данных клиентов. |
| N6 | Наблюдаемость: журнал “какая версия отправлена/доставлена/подтверждена”. |
| N7 | Совместимость: использовать существующие технологии и контуры (внутренние сервисы ставок/БД). |

---

### **Решение**

#### 1) Диаграммы C4 (файлы в папке Task4)
- C4 Context: `Task4/c4-context.png` (исходник `Task4/c4-context.drawio`)
- C4 Components: `Task4/c4-components.png` (исходник `Task4/c4-components.drawio`)

#### 2) Архитектура передачи ставок

**Внутренний кол-центр (система кол-центра в инфраструктуре банка):**
- Получает ставки из внутреннего сервиса ставок (RPS/реестр ставок) по защищённому каналу (HTTPS/JSON).
- Для надёжности использует кэш последней версии + timestamp обновления.

**Партнёрский кол-центр (внешняя система):**
- Банк формирует “пакет ставок” в файле: `rates_YYYYMMDD_HHMM_vNN.csv` + `rates_...sha256` (контроль целостности).
- Канал доставки: **корпоративная почта с вложением** (или иной “файловый” канал, не являющийся API-вызовом).  
  *Примечание:* в задании сказано “готовы получать в виде файлов” и “нет возможности сделать API-вызовы (например, SFTP)” — email с файлами соответствует этому ограничению.
- Партнёр импортирует файл вручную или своим регламентом.

**Контроль версии и целостности:**
- Каждая публикация ставок создаёт версию (vNN), timestamp, автора изменения.
- Отправка партнёру логируется (время отправки, адресат, версия).
- Желательно получить подтверждение получения (reply/регламент) — как операционный процесс.

#### 3) Компоненты (логические)

- Rate Publisher (в RPS): публикует новую версию.
- Rate Exporter: формирует CSV + checksum (sha256) + метаданные.
- Mail Sender: отправляет файл партнёру; ретраи; алерты.
- CallCenter Rate API Client: внутренний кол-центр читает ставки и кэширует.

---

### **Альтернативы**

1) SFTP/FTPS — похоже на “файлы”, но в задании приведено как пример запрета (“например, через SFTP-протокол”) → не подходит.
2) Прямой API партнёру — запрещено.
3) Общий портал/личный кабинет партнёра для скачивания — технически тоже API (HTTP), потребует согласований и разработки у партнёра; в MVP риск по срокам.

---

**Недостатки, ограничения, риски**

- Email-канал: возможны задержки/блокировки вложений/ручные ошибки импорта.
  Митигировать: ретраи отправки, контрольный отчёт “нет подтверждения получения”, простая инструкция импорта для партнёра.
- Актуальность: партнёр может работать на старой версии.
  Митигировать: версия/время в самом файле + обязательное отображение версии в UI партнёра (если возможно).
- Рост версий: нужен регламент хранения (например, хранить последние 30 версий).
